# Aviasales Telegram Price Monitor Bot

Профессиональный инструмент на языке Go для автоматического отслеживания стоимости авиабилетов через API Aviasales (Travelpayouts). Бот работает в фоновом режиме, анализирует изменения цен и мгновенно уведомляет пользователя в Telegram.

## Ключевые особенности

- **Автономный воркер**: Использование горутин позволяет боту одновременно обрабатывать команды пользователей и выполнять фоновые запросы к API без задержек.
- **Интеллектуальная система уведомлений**: Бот сравнивает текущую цену с последней сохраненной в базе данных. Вы получите сообщение только в том случае, если цена изменилась (выросла или упала).
- **Поддержка мультиканальности**: Архитектура базы данных позволяет одному боту обслуживать множество пользователей одновременно, сохраняя индивидуальные подписки для каждого chat_id.

## Технологический стек

- **Язык**: Go (Golang) 1.25.
- **База данных**: PostgreSQL.
- **Библиотеки**:
  - `github.com/go-telegram-bot-api/telegram-bot-api/v5` — взаимодействие с Telegram API.
  - `github.com/jmoiron/sqlx` — расширенные возможности работы с SQL и маппинга данных.
  - `github.com/joho/godotenv` — управление конфигурациями.
- **API**: Aviasales Data API (Travelpayouts) V3.

## Установка и запуск

### 1. Клонирование репозитория
git clone https://github.com/Dzetner/go-tg_bot-price-monitor.git
cd go-tg_bot-price-monitor

### 2. Настройка конфигурации
Создайте файл .env и укажите ваши данные:
TELEGRAM_TOKEN=123456:ABC-DEF1234...
TRAVELPAYOUTS_TOKEN=ваш_API_токен
DB_DSN=postgres://postgres:password@localhost:5432/bot_db?sslmode=disable

### 3. Запуск инфраструктуры
Для быстрого развертывания базы данных используйте Docker:
docker-compose up -d

### 4. Компиляция и запуск
go run main.go

## Команды бота

- /add [ORIGIN] [DEST] — Добавляет новое направление для слежки. Пример: /add MOW HRG
- /list — Выводит список всех ваших активных подписок с актуальными ценами на текущий момент.
- /del [ORIGIN-DEST] — Останавливает мониторинг и удаляет подписку. Пример: /del MOW-HRG

## Как это работает (Architecture)

1. Фоновый воркер: При старте бота запускается отдельная долгоживущая горутина (Long-running Goroutine), которая отвечает за мониторинг цен.
2. Цикл проверки: Внутри горутины используется таймер (time.Ticker), который каждые 5 минут инициирует процесс опроса:
   - Бот выгружает список всех активных подписок из PostgreSQL.
   - Для каждого направления выполняется HTTP-запрос к API Aviasales.
3. Сравнение состояний: Если цена билета из ответа API отличается от сохраненного значения в базе данных, бот:
   - Отправляет уведомление пользователю в Telegram.
   - Обновляет поле last_value в БД для отслеживания будущих изменений.

## Планы по развитию

- Реализация поиска билетов на конкретные месяцы.
- Добавление графиков изменения цен прямо в чат Telegram.
- Интеграция с другими агрегаторами для более широкого поиска.
